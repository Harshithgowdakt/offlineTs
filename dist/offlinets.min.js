!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).OfflineTs=e()}}(function(){return function(){return function r(e,t,i){function o(s,a){if(!t[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=t[s]={exports:{}};e[s][0].call(f.exports,function(t){return o(e[s][1][t]||t)},f,f.exports,r,e,t,i)}return t[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}}()({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./src/ServiceStatus");i.StateType=n.StateType,i.ServiceStatus=n.ServiceStatus;const r=e("./src/sync/sync");i.sync=r},{"./src/ServiceStatus":3,"./src/sync/sync":7}],2:[function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function fulfilled(e){try{step(n.next(e))}catch(e){s(e)}}function rejected(e){try{step(n.throw(e))}catch(e){s(e)}}function step(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});i.defaultPingService=new class{ping(){return n(this,void 0,void 0,function*(){return new Promise(e=>{fetch(new Request("/favico.ico?_="+(new Date).getTime()),{method:"HEAD",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),mode:"cors",cache:"default",credentials:"same-origin"}).then(t=>{200===t.status?e(!0):e(!1)}).catch(t=>{e(!1)})})})}}},{}],3:[function(e,t,i){"use strict";var n,r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function fulfilled(e){try{step(n.next(e))}catch(e){s(e)}}function rejected(e){try{step(n.throw(e))}catch(e){s(e)}}function step(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0}),function(e){e[e.ONLINE=0]="ONLINE",e[e.OFFLINE=1]="OFFLINE"}(n=i.StateType||(i.StateType={}));i.ServiceStatus=class{constructor(e){this.ping=e,this.observers=new Map,this.state=n.ONLINE,this.Observe=(e=>{var t=this;return class extends e{constructor(...e){super(...e),this.ObserverId=Date.now()*Math.random()*1e3,t.attach(this)}}})}observe(e){e=this.Observe(e)}attach(e){if(!e.ObserverId)throw new Error("ObserverId Not Set.");this.observers.set(e.ObserverId,e)}set Ping(e){this.ping=e}set Period(e){this.cancelInterval(),this.period=e,this.interval=setInterval(()=>this.callback(),this.period)}set State(e){this.state=e,this.notify()}get State(){return this.state}goOnline(){return this.State!==n.ONLINE&&(this.State=n.ONLINE),this}goOffline(){return this.State!==n.OFFLINE&&(this.State=n.OFFLINE),this}notify(){this.observers.forEach(e=>e.updateState(this.State))}callback(){return r(this,void 0,void 0,function*(){if(this.ping)return(yield this.ping.ping())?this.goOnline():this.goOffline()})}cancelInterval(){this.interval&&clearInterval(this.interval)}startPing(e){if(!e)throw new Error("Cannot start ping without interval time.");if(!this.ping)throw new Error("No Ping service set.");this.Period=e}}},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(e){e[e.ONLINE=0]="ONLINE",e[e.OFFLINE=1]="OFFLINE"}(i.StateType||(i.StateType={}))},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.OfflineDataService=class{sync(){throw new Error("Not yet Implemented")}hasData(){throw new Error("Not yet Implemented")}}},{}],6:[function(e,t,i){"use strict";var n=this&&this.__decorate||function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function fulfilled(e){try{step(n.next(e))}catch(e){s(e)}}function rejected(e){try{step(n.throw(e))}catch(e){s(e)}}function step(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const s=e("../StateType"),a=e("./OfflineDataService"),o=e("../ServiceStatus"),c=e("../PingService");var u;!function(e){e[e.WAITING=0]="WAITING",e[e.NO_DATA=1]="NO_DATA",e[e.DATA=2]="DATA"}(u=i.SyncStatus||(i.SyncStatus={}));var f=new o.ServiceStatus(c.defaultPingService);i.SyncServiceStatus=f;let l=class{constructor(e=new a.OfflineDataService,t=1/0){this.offlineDataService=e,this.maxRetry=t,this.state=u.WAITING}get State(){return this.state}set State(e){this.state=e}updateState(e){return r(this,void 0,void 0,function*(){e===s.StateType.ONLINE&&(yield this.onOnline())})}onOnline(){return r(this,void 0,void 0,function*(){yield this.sync()})}sync(){return r(this,void 0,void 0,function*(){(yield this.offlineDataService.hasData())?yield this.transitionToDataState():this.transitionToNoDataState()})}transitionToNoDataState(){this.State=u.NO_DATA}transitionToDataState(){return r(this,void 0,void 0,function*(){let e=0,t=!1;for(;!t;)try{if(e++,this.State=u.DATA,t=yield this.offlineDataService.sync())this.transitionToNoDataState();else if(e===this.maxRetry)return}catch(t){if(e===this.maxRetry)throw new Error(t)}})}};l=n([f.Observe],l),i.SyncService=l},{"../PingService":2,"../ServiceStatus":3,"../StateType":4,"./OfflineDataService":5}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./OfflineDataService");i.OfflineDataService=n.OfflineDataService;var r=e("./SyncService");i.SyncService=r.SyncService,i.SyncServiceStatus=r.SyncServiceStatus,i.SyncStatus=r.SyncStatus},{"./OfflineDataService":5,"./SyncService":6}]},{},[1])(1)});